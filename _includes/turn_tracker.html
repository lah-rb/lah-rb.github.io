<!-- Phase 3b: Turn tracker with HTMX + WASM state management.
     The popover toggle (showTurnTracker) stays Alpine — purely visual.
     Timer creation form is loaded from WASM. Alarm state lives in WASM memory.
     Hides when multiplayer room is connected (multiplayer_turn_tool.html takes over). -->
<div x-data="{ showTurnTracker: false, roomConnected: false }"
     @room-connected.window="roomConnected = true"
     @room-disconnected.window="roomConnected = false">
    <svg xmlns="http://www.w3.org/2000/svg"
    @click="showTurnTracker = !showTurnTracker"
    x-show="!roomConnected" x-cloak
    x-ref="turnTracker"
    viewBox="0 0 24 24"
    {% unless page.landscape %}
        :class="'lg:stroke-kip-goldenrod'"
    {% endunless %}
    class="{{ include.base_stroke }}{{ include.svgClass }}">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>

    <div x-show="showTurnTracker && !roomConnected" x-cloak
    x-anchor.right-end.offset.10="$refs.turnTracker"
    x-transition.duration.350ms
    class="{{ include.menuClass }} grid grid-cols-1 h-fit w-56"
    hx-get="/api/game/turns"
    hx-trigger="intersect once"
    hx-swap="innerHTML">
    </div>
</div>

<!-- Floating alarm display — loaded from WASM, positioned top-left.
     Skips initial load when a multiplayer room session exists in sessionStorage;
     the multiplayer module's refreshAlarms(true) will populate it after reconnect. -->
<div id="turn-alarms" class="fixed top-0 left-0 m-6 grid grid-cols-1"
     x-data
     x-init="if (!sessionStorage.getItem('kipukas_room')) htmx.ajax('GET', '/api/game/turns?display=alarms', {target:'#turn-alarms', swap:'innerHTML'})">
</div>
