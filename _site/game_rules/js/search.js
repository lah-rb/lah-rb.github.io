const KipukasSearch=(()=>{let o=null,c=[];function g(){c=[],document.getElementById("content").querySelectorAll("h2, h3").forEach((t,l)=>{const n=t.id||"",e=t.textContent.replace("#","").trim();if(!e)return;let i="",s=t.nextElementSibling;for(;s&&!s.matches("h2, h3");)i+=" "+s.textContent,s=s.nextElementSibling;c.push({id:n,title:e,text:i.trim()})})}function f(t){if(!t||t.length<2)return[];const l=t.toLowerCase().split(/\s+/).filter(e=>e.length>1),n=[];return c.forEach(e=>{const i=(e.title+" "+e.text).toLowerCase();if(!l.every(d=>i.includes(d)))return;const s=e.title+" "+e.text,u=s.toLowerCase().indexOf(l[0]),h=Math.max(0,u-40),m=Math.min(s.length,u+l[0].length+80);let a=(h>0?"...":"")+s.slice(h,m)+(m<s.length?"...":"");l.forEach(d=>{const E=new RegExp(`(${p(d)})`,"gi");a=a.replace(E,'<mark class="search-highlight">$1</mark>')}),n.push({id:e.id,title:e.title,snippet:a})}),n.slice(0,15)}function p(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(t,l){if(t.length===0){l.innerHTML=`
                <div class="p-4 text-center text-slate-500 text-sm">
                    No results found
                </div>`,l.classList.remove("hidden");return}l.innerHTML=t.map(n=>`
            <a href="#${n.id}" class="block px-4 py-3 hover:bg-sky-50 border-b border-sky-100 last:border-0 transition-colors search-result-item" data-target-id="${n.id}">
                <div class="font-semibold text-sky-900 text-sm">${n.title}</div>
                <div class="text-xs text-slate-600 mt-1 leading-relaxed">${n.snippet}</div>
            </a>
        `).join(""),l.classList.remove("hidden"),l.querySelectorAll(".search-result-item").forEach(n=>{n.addEventListener("click",e=>{e.preventDefault();const i=n.dataset.targetId,s=document.getElementById(i);s&&(s.scrollIntoView({behavior:"smooth",block:"start"}),history.replaceState(null,"",`#${i}`),s.style.background="#fef3c7",setTimeout(()=>{s.style.background=""},2e3)),r(),document.getElementById("search-input").value="",document.getElementById("search-clear").classList.add("hidden")})})}function r(){document.getElementById("search-results").classList.add("hidden")}function v(){const t=document.getElementById("search-input"),l=document.getElementById("search-results"),n=document.getElementById("search-clear");t.addEventListener("input",()=>{const e=t.value.trim();n.classList.toggle("hidden",!e),clearTimeout(o),o=setTimeout(()=>{if(e.length<2){r();return}const i=f(e);y(i,l)},200)}),t.addEventListener("keydown",e=>{e.key==="Escape"&&(t.value="",n.classList.add("hidden"),r(),t.blur())}),n.addEventListener("click",()=>{t.value="",n.classList.add("hidden"),r(),t.focus()}),document.addEventListener("click",e=>{document.getElementById("search-wrapper").contains(e.target)||r()}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),t.focus(),t.select())})}return{indexContent:g,init:v}})();
