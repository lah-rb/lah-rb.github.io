const KipukasSearch=(()=>{let h=null,d=[];function p(){d=[],document.getElementById("content").querySelectorAll("h2, h3").forEach((n,e)=>{const l=n.id||"",c=n.textContent.replace("#","").trim();if(!c)return;let i="",r=n.nextElementSibling;for(;r&&!r.matches("h2, h3");)i+=" "+r.textContent,r=r.nextElementSibling;d.push({id:l,title:c,text:i.trim()})})}function x(t){if(!t||t.length<2)return[];const s=t.toLowerCase().split(/\s+/).filter(e=>e.length>1),n=[];return d.forEach(e=>{const l=(e.title+" "+e.text).toLowerCase();if(!s.every(u=>l.includes(u)))return;const i=e.title+" "+e.text,m=i.toLowerCase().indexOf(s[0]),g=Math.max(0,m-40),f=Math.min(i.length,m+s[0].length+80);let o=(g>0?"...":"")+i.slice(g,f)+(f<i.length?"...":"");s.forEach(u=>{const k=new RegExp(`(${E(u)})`,"gi");o=o.replace(k,'<mark class="search-highlight">$1</mark>')}),n.push({id:e.id,title:e.title,snippet:o})}),n.slice(0,15)}function E(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(t,s){if(t.length===0){s.innerHTML=`
                <div class="p-4 text-center text-slate-500 text-sm">
                    No results found
                </div>`,s.classList.remove("hidden");return}s.innerHTML=t.map(n=>`
            <a href="#${n.id}" class="block px-4 py-3 hover:bg-sky-50 border-b border-sky-100 last:border-0 transition-colors search-result-item" data-target-id="${n.id}">
                <div class="font-semibold text-sky-900 text-sm">${n.title}</div>
                <div class="text-xs text-slate-600 mt-1 leading-relaxed">${n.snippet}</div>
            </a>
        `).join(""),s.classList.remove("hidden"),s.querySelectorAll(".search-result-item").forEach(n=>{n.addEventListener("click",e=>{e.preventDefault();const l=n.dataset.targetId,c=document.getElementById(l);c&&(c.scrollIntoView({behavior:"smooth",block:"start"}),history.replaceState(null,"",`#${l}`),c.style.background="#fef3c7",setTimeout(()=>{c.style.background=""},2e3)),a(),document.getElementById("search-input").value="",document.getElementById("search-clear").classList.add("hidden")})})}function a(){document.getElementById("search-results").classList.add("hidden")}function v(){const t=document.getElementById("search-input"),s=document.getElementById("search-results"),n=document.getElementById("search-clear");t.addEventListener("input",()=>{const e=t.value.trim();n.classList.toggle("hidden",!e),clearTimeout(h),h=setTimeout(()=>{if(e.length<2){a();return}const l=x(e);y(l,s)},200)}),t.addEventListener("keydown",e=>{e.key==="Escape"&&(t.value="",n.classList.add("hidden"),a(),t.blur())}),n.addEventListener("click",()=>{t.value="",n.classList.add("hidden"),a(),t.focus()}),document.addEventListener("click",e=>{document.getElementById("search-wrapper").contains(e.target)||a()}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),t.focus(),t.select())})}return{indexContent:p,init:v}})();
