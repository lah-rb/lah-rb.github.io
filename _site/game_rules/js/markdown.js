const KipukasMarkdown=(()=>{const u=[{test:/_qr\./i,classes:"w-20 h-20 object-cover rounded shadow-sm inline-block"},{test:/\/(capital|basecamp|soul_token|d6|diel_die|d20)\./i,classes:"w-64 h-auto rounded-lg shadow-md mx-auto block"},{test:/\/(A_frame|log_cabin|plain_house|modern_home|boat|tunnel|dock)\./i,classes:"w-36 h-auto rounded-lg shadow-md mx-auto block"},{test:/\/initials\./i,classes:"w-16 h-auto !shadow-none"},{test:/\/front_cover/i,classes:"w-96 h-auto rounded-xl shadow-lg mx-auto block justify-center"},{test:/\/(hilbert_king_of_avian_frogs|myrthvither_raven)(_back)?\./i,classes:"w-96 h-auto rounded-xl shadow-lg"},{test:/\/keal_means_/i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/(QR_modal|QR_scanner)\./i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/fists_/i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/recipe_lookup/i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/(motives|placement_courtesy|12_slot_rec_mat)/i,classes:"max-w-md h-auto rounded-lg shadow mx-auto block"},{test:/\/map_top_example/i,classes:"max-w-sm h-auto rounded-xl shadow-lg"},{test:/\/(map_perspective|map_top)\./i,classes:"max-w-lg h-auto rounded-xl shadow-lg mx-auto block"}],h="max-w-md h-auto rounded-lg shadow-md";function g(o){for(const s of u)if(s.test.test(o))return s.classes;return h}function d(o){o.querySelectorAll("p").forEach(s=>{const t=s.querySelectorAll("img");if(t.length<2)return;const e=s.cloneNode(!0);e.querySelectorAll("img, a").forEach(a=>a.remove()),!(e.textContent.trim().length>10)&&(s.classList.add("flex","flex-wrap","gap-4","items-start","justify-center","my-6","not-prose"),t.forEach(a=>{a.classList.remove("mx-auto","block"),a.classList.add("flex-shrink-0");const n=t.length===2?"max-w-[48%]":"max-w-[30%]";a.classList.add(n)}))})}function w(){const o=new marked.Renderer,s=/\{#([^}]+)\}\s*$/;function t(e,a){const n=e.match(s);let r,l;if(n?(r=n[1],l=e.replace(s,"").trim()):(r=e.toLowerCase().replace(/<[^>]*>/g,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"_").replace(/-+/g,"_").trim(),l=e),!l)return"";const c=`<a class="header-anchor" href="#${r}" title="Link to this section">#</a>`;return`<h${a} id="${r}">${l}${c}</h${a}>
`}return o.heading=function(e){return typeof e=="object"&&e.text!==void 0?t(e.text,e.depth):t(e,arguments[1])},o.image=function(e){let a,n,r;typeof e=="object"&&e.href!==void 0?(a=e.href,n=e.title,r=e.text):(a=e,n=arguments[1],r=arguments[2]);const l=g(a||""),c=(r||"").replace(/"/g,"&quot;"),f=n?` title="${n.replace(/"/g,"&quot;")}"`:"";return`<img src="${a}" alt="${c}" class="${l}"${f} loading="lazy">`},o}function i(o){const s=[];return o.querySelectorAll("h2, h3").forEach(t=>{t.id&&t.textContent.replace("#","").trim()&&s.push({id:t.id,text:t.textContent.replace("#","").trim(),level:t.tagName==="H2"?2:3,element:t})}),s}function m(){if(window.location.hash){const o=document.getElementById(window.location.hash.slice(1));o&&setTimeout(()=>o.scrollIntoView({behavior:"smooth"}),100)}}async function p(){const o=document.getElementById("content"),s=document.getElementById("loading");if(o.querySelectorAll("h2, h3").length>0){s&&s.remove(),d(o);const t=i(o);return m(),t}try{const t=await fetch("rules.md");if(!t.ok)throw new Error(`Failed to load rules.md: ${t.status}`);let e=await t.text();e=e.replace(/<!--\s*pagebreak\s*-->/gi,'<div class="page-break"></div>'),marked.setOptions({renderer:w(),breaks:!0,gfm:!0});const a=marked.parse(e),n=DOMPurify.sanitize(a,{ADD_ATTR:["id","target","class","loading"]});s&&s.remove(),o.innerHTML=n,d(o);const r=i(o);return m(),r}catch(t){return console.error("Error loading markdown:",t),s&&(s.innerHTML=`
                    <div class="text-center text-red-600">
                        <p class="text-lg font-semibold">Failed to load rules</p>
                        <p class="text-sm mt-2">${t.message}</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700">Retry</button>
                    </div>`),[]}}return{loadAndRenderMarkdown:p}})();
