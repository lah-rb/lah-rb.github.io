const KipukasMarkdown=(()=>{const m=[{test:/_qr\./i,classes:"w-20 h-20 object-cover rounded shadow-sm inline-block"},{test:/\/(capital|basecamp|soul_token|d6|diel_die|d20)\./i,classes:"w-64 h-auto rounded-lg shadow-md mx-auto block"},{test:/\/(A_frame|log_cabin|plain_house|modern_home|boat|tunnel|dock)\./i,classes:"w-36 h-auto rounded-lg shadow-md mx-auto block"},{test:/\/initials\./i,classes:"w-16 h-auto !shadow-none"},{test:/\/front_cover/i,classes:"w-96 h-auto rounded-xl shadow-lg mx-auto block justify-center"},{test:/\/(hilbert_king_of_avian_frogs|myrthvither_raven)(_back)?\./i,classes:"w-96 h-auto rounded-xl shadow-lg"},{test:/\/keal_means_/i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/(QR_modal|QR_scanner)\./i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/fists_/i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/recipe_lookup/i,classes:"max-w-sm h-auto rounded-lg shadow-md"},{test:/\/(motives|placement_courtesy|12_slot_rec_mat)/i,classes:"max-w-md h-auto rounded-lg shadow mx-auto block"},{test:/\/map_top_example/i,classes:"max-w-sm h-auto rounded-xl shadow-lg"},{test:/\/(map_perspective|map_top)\./i,classes:"max-w-lg h-auto rounded-xl shadow-lg mx-auto block"}],h="max-w-md h-auto rounded-lg shadow-md";function g(t){for(const s of m)if(s.test.test(t))return s.classes;return h}function i(t){t.querySelectorAll("p").forEach(s=>{const r=s.querySelectorAll("img");if(r.length<2)return;const e=s.cloneNode(!0);e.querySelectorAll("img, a").forEach(o=>o.remove()),!(e.textContent.trim().length>10)&&(s.classList.add("flex","flex-wrap","gap-4","items-start","justify-center","my-6","not-prose"),r.forEach(o=>{o.classList.remove("mx-auto","block"),o.classList.add("flex-shrink-0");const n=r.length===2?"max-w-[48%]":"max-w-[30%]";o.classList.add(n)}))})}function f(){const t=new marked.Renderer,s=/\{#([^}]+)\}\s*$/;function r(e,o){const n=e.match(s);let a,l;if(n?(a=n[1],l=e.replace(s,"").trim()):(a=e.toLowerCase().replace(/<[^>]*>/g,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"_").replace(/-+/g,"_").trim(),l=e),!l)return"";const c=`<a class="header-anchor" href="#${a}" title="Link to this section">#</a>`;return`<h${o} id="${a}">${l}${c}</h${o}>
`}return t.heading=function(e){return typeof e=="object"&&e.text!==void 0?r(e.text,e.depth):r(e,arguments[1])},t.image=function(e){let o,n,a;typeof e=="object"&&e.href!==void 0?(o=e.href,n=e.title,a=e.text):(o=e,n=arguments[1],a=arguments[2]);const l=g(o||""),c=(a||"").replace(/"/g,"&quot;"),p=n?` title="${n.replace(/"/g,"&quot;")}"`:"";return`<img src="${o}" alt="${c}" class="${l}"${p} loading="lazy">`},t}function d(t){const s=[];return t.querySelectorAll("h2, h3").forEach(r=>{r.id&&r.textContent.replace("#","").trim()&&s.push({id:r.id,text:r.textContent.replace("#","").trim(),level:r.tagName==="H2"?2:3,element:r})}),s}function u(){if(window.location.hash){const t=document.getElementById(window.location.hash.slice(1));t&&setTimeout(()=>t.scrollIntoView({behavior:"smooth"}),100)}}async function w(){const t=document.getElementById("content"),s=document.getElementById("loading");if(t.querySelectorAll("h2, h3").length>0){s&&s.remove(),i(t);const e=d(t);return u(),e}try{const e=await fetch("rules.md");if(!e.ok)throw new Error(`Failed to load rules.md: ${e.status}`);let o=await e.text();o=o.replace(/<!--\s*pagebreak\s*-->/gi,'<div class="page-break"></div>'),marked.setOptions({renderer:f(),breaks:!0,gfm:!0});const n=marked.parse(o),a=DOMPurify.sanitize(n,{ADD_ATTR:["id","target","class","loading"]});s&&s.remove(),t.innerHTML=a,i(t);const l=d(t);return u(),l}catch(e){return console.error("Error loading markdown:",e),s&&(s.innerHTML=`
                    <div class="text-center text-red-600">
                        <p class="text-lg font-semibold">Failed to load rules</p>
                        <p class="text-sm mt-2">${e.message}</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700">Retry</button>
                    </div>`),[]}}return{loadAndRenderMarkdown:w}})();
