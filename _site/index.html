<!DOCTYPE html>
<html lang="en-US">
  <head>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Binder Home | Kipukas</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Binder Home" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the home of all the cards ever produced by Kipukas! Whether you are planning you next dominating game strategy or browsing for lovely pieces of art you came to the right place." />
<meta property="og:description" content="This is the home of all the cards ever produced by Kipukas! Whether you are planning you next dominating game strategy or browsing for lovely pieces of art you came to the right place." />
<link rel="canonical" href="https://www.kipukas.cards/" />
<meta property="og:url" content="https://www.kipukas.cards/" />
<meta property="og:site_name" content="Kipukas" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Binder Home" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"This is the home of all the cards ever produced by Kipukas! Whether you are planning you next dominating game strategy or browsing for lovely pieces of art you came to the right place.","headline":"Binder Home","name":"Kipukas","url":"https://www.kipukas.cards/"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Binder Home</title>
    <link rel="stylesheet" href="/assets/css/output.css">
    <style>
      /* Skeleton loading animation for card images */
      @keyframes skeleton-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }
      .skeleton-pulse {
        animation: skeleton-pulse 1.5s ease-in-out infinite;
        background: linear-gradient(90deg, #e2e8f0 25%, #cbd5e1 50%, #e2e8f0 75%);
        background-size: 200% 100%;
      }
      /* Smooth image fade-in transition */
      .card-image {
        transition: opacity 0.3s ease-out;
      }
      .card-image.opacity-0 {
        opacity: 0;
      }
    </style>
    <!-- Preload critical scripts to reduce parse/evaluation time -->
    <link rel="preload" href="/assets/js/htmx.min.js" as="script">
    <link rel="preload" href="/assets/js/alpine.bundle.min.js" as="script">
    <link rel="preload" href="/assets/js/kipukas-api.js" as="script">
    <link rel="preload" href="/manifest.json" as="fetch" crossorigin="anonymous">
    <link rel="manifest" href="/manifest.json">
    
    <!--favicon code realfavicongenerator.net-->
    <link rel="preload" href="/assets/js-wasm/ios-pwa-splash.js" as="script">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/ico/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/ico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/ico/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/ico/favicon-16x16.png">
    <link rel="mask-icon" href="/assets/ico/safari-pinned-tab.svg" color="#9b2c2c">
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Kipukas">
    <meta name="application-name" content="Kipukas">
    <meta name="msapplication-TileColor" content="#9b2c2c">
    <meta name="theme-color" content="#9b2c2c">

    <script src="/assets/js-wasm/ios-pwa-splash.js">
      document.addEventListener('DOMContentLoaded', function() {
        iosPWASplash('/assets/utiltity_images/small_kip_logo.png', '#9b2c2c');
      });
    </script>
    <script defer src="/assets/js/alpine.bundle.min.js"></script>

    <!-- WASM API bridge: relays SW messages to WASM Web Worker -->
    <script src="/assets/js/kipukas-api.js" defer></script>

    <script defer src="/assets/js/htmx.min.js"></script>

    <!-- PWA: service worker registration + update-then-refresh flow -->
    <script src="/assets/js/pwa-update-handler.js" defer></script>

    <!-- Lazy loading helpers for feature-specific scripts -->
    <script>
      // Lazy load QR camera only when needed
      window.kipukasLoadQR = function() {
        if (window.kipukasQRLoaded) return Promise.resolve();
        return import('/assets/js/qr-camera.js')
          .then(function() {
            window.kipukasQRLoaded = true;
          })
          .catch(function(err) {
            console.error('Failed to load QR camera:', err);
          });
      };

      // Lazy load Multiplayer only when needed
      window.kipukasLoadMultiplayer = function() {
        if (window.kipukasMultiplayerLoaded) return Promise.resolve();
        return import('/assets/js/kipukas-multiplayer.js')
          .then(function() {
            window.kipukasMultiplayerLoaded = true;
          })
          .catch(function(err) {
            console.error('Failed to load multiplayer:', err);
          });
      };
    </script>

  </head>

  <body x-data="{ 
                  filter: { all: true }, 
                  showInstallModal: false,
                  searchQuery: '',
                  top: true,
                  previousURL: $persist(''),
                  currentURL: $persist(''),
                  hideInstallButton: $persist(false),
                }" 
        class="bg-hero-pattern z-0 bg-emerald-50 bg-fixed font-serif antialiased scroll-smooth w-dvw h-dvh"
        x-init="previousURL = currentURL, currentURL = window.location.href">
    <div x-intersect:leave="top = false" x-intersect:enter="top = true"></div>
    <!-- Spinner: hidden by default, shown programmatically when needed -->
<div id="spinner" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
  <svg class="z-40 animate-spin h-7 w-7 text-kip-red" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="stroke-slate-500/50 stroke-5" cx="12" cy="12" r="10"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
  </svg>
</div>

    <div><!-- includes available
hamburger
qr_scanner
type_matchup
damage_tracker
showCardInfo
lastPage
logo
goHome
hideTools
base_fill
base_stroke
background_color
  
-->


<div class="w-screen h-fit z-0 justify-center flex place-items-center mb-2">
  <a href="./" class="w-64" title="Binder Home">
    <img class="h-32 w-64 transition hover:scale-95 active:transform-none" src="/assets/utility_images/kipukas_complete_card_collection.svg" alt="Kipukas Complete Card Collection" fetchpriority="high"></img>
  </a>
</div>


<div x-cloak x-data="{ showHamburger: false, showSearchBar: false, showTools: $persist(true) }" class="z-40 bg-slate-100/80 rounded-lg grid justify-items-center fixed top-0 right-0 w-15 pt-2 mx-2 my-6 md:m-8">
  

  

  
  

  
    <div x-show="showHamburger" 
    x-anchor.right-end.offset.10="$refs.hamburger" 
    x-transition.duration.350ms
    x-cloak
    class="text-nowrap bg-amber-50 mt-2 h-fit w-fit py-3 px-1 rounded-md shadow-lg ring-1 ring-black/5 focus:outline-hidden z-50">
    <div><a href="/" class="self-center p-2 text-center text-xl text-kip-drk-goldenrod rounded-lg hover:bg-amber-100 active:bg-amber-100">Binder Home</a></div>
    <div><a href="/game_rules/index.html" class="self-center p-2 text-center text-xl text-kip-drk-goldenrod rounded-lg hover:bg-amber-100 active:bg-amber-100">See the Rules</a></div>
    <div><a href="/recipes" class="self-center p-2 text-center text-xl text-kip-drk-goldenrod rounded-lg hover:bg-amber-100 active:bg-amber-100">View Item Recipes</a></div>
    <div><a href="/privacy_policy" class="self-center p-2 text-center text-xl text-kip-drk-goldenrod rounded-lg hover:bg-amber-100 active:bg-amber-100">Privacy Policy</a></div>
    <div><a href="/about_articles" class="self-center p-2 text-center text-xl text-kip-drk-goldenrod rounded-lg hover:bg-amber-100 active:bg-amber-100">About Kipukas</a></div>
</div>

<div class="py-3 px-3 flex flex-initial justify-end content-center self-center">
    <button class="hover:bg-amber-100 active:bg-amber-100 text-kip-drk-goldenrod w-12 h-12 relative bg-amber-50 rounded-lg"
            @click="showHamburger = !showHamburger" 
            :class="{'shadow-lg': ! showHamburger}" 
            x-ref="hamburger"
            aria-label="extra nav menu">
        <span class="sr-only">show main menu</span>
        <div class="block w-5 absolute left-1/2 top-1/2  transform  -translate-x-1/2 -translate-y-1/2">
            <span class="block absolute h-0.5 w-6 bg-current transform transition duration-500" :class="{'rotate-45': showHamburger,' -translate-y-1.5': !showHamburger }"></span>
            <span class="block absolute  h-0.5 w-6 bg-current transform transition duration-500" :class="{'opacity-0': showHamburger } "></span>
            <span class="block absolute  h-0.5 w-6 bg-current transform  transition duration-500" :class="{'-rotate-45': showHamburger, ' translate-y-1.5': !showHamburger}"></span>
        </div>
    </button>
  </div>
  

  <div x-show="showTools" x-collapse  class="grid grid-cols-1">
    
      <script>
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
    // Prevent the default behavior (which would be to show the install prompt automatically)
    e.preventDefault();
    // Stash the event so it can be triggered later.
    deferredPrompt = e;
    });

    const timer = ms => new Promise(res => setTimeout(res, ms))

    async function checkPWAInstallStatus() {
        let i = 0;
        while ( i < 10 ){
            console.log(deferredPrompt);
            await timer(1000);
            i++;
        }
    }

    // Check if the deferred prompt isn't null, then show the prompt
    function handlePWAInstall() {
    if (deferredPrompt) {
        deferredPrompt.prompt();

        // Wait for the user to make a choice
        deferredPrompt.userChoice.then((choiceResult) => {
            // Log the choice to our console
            console.log(choiceResult.outcome);

            // We've used the prompt, and can't use it again, so set this to null
            deferredPrompt = null;
        });
    } else {
        alert(`You are unable to install the Kipukas Binder web app at this time.
        
If you already installed our app, then great! This is expected because you don't need to install it again. We would have already hidden this, but a pwa can't tell if it is installed or not ðŸ˜…. Click ok to hide the install button.
        
If you have not already installed our pwa, check if your browser (and launcher if on android) support(s) pwa installs. While many browsers work well, Chromium based browsers (i.e. Bromite, Vanadium, Brave, and of course Google Chrome) deliver the most consistent experience across devices followed closely by firefox. We will go ahead and hide the install button.`);

        // Hide the install button
        alpinel._x_dataStack[0].hideInstallButton = true;
    }
}
    
</script>
<template x-if="true">
    <button class="place-content-center mb-2" x-show="!hideInstallButton">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            alt="install pwa icon" @click="showInstallModal = !showInstallModal"
            class="h-14 w-14 stroke-2 fill-none stroke-kip-goldenrod hover:stroke-kip-red active:stroke-kip-drk-sienna">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
        </svg>
    </button>
</template>



<div x-show="showInstallModal" class="fixed top-0 left-0 right-0 h-screen w-screen inset-0 flex items-center justify-center z-50" x-cloak>

    <template x-if="true"> <!--This template makes sure the modal does not display when unneeded-->
      <div class="z-50 absolute inset-0 bg-slate-300 opacity-75"></div>
    </template>
  
    <template x-if="true"> <!--This template makes sure the modal does not display when unneeded-->
      <div class="bg-amber-50 z-50 p-6 rounded-lg shadow-xl w-full max-w-lg">
        <h2 class="text-xl font-semibold mb-4 text-kip-drk-sienna">Install Notice</h2>
        <p class="mb-4 text-kip-drk-sienna">
            This website is designed as a progressive web app or pwa. This means that it can be installed on your device, which allows you a native like experience on any platform. This also allows for a better offline experience. This does not mean that we collect any data from you, should you decide to install our pwa.
        </p>
  
        <button @click="showInstallModal = !showInstallModal, handlePWAInstall()" class="bg-kip-red hover:bg-emerald-600 text-amber-50 font-bold py-2 my-2 px-4 rounded">
          Install
        </button>
  
        <button @click="showInstallModal = !showInstallModal" class="bg-kip-red hover:bg-emerald-600 text-amber-50 font-bold py-2 px-4 rounded">
          I'll use the website as is.
        </button>
        
  <div><input type="checkbox" @click="hideInstallButton = !hideInstallButton" id="hideInstall" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100"><label for="hideInstall">Hide the install button for subsequent visits, please.</label></div>

      </div>
    </template>
  </div>

    

    
      <!-- QR Scanner â€” Phase 2: HTMX + WASM driven
     UI state managed by /api/qr/status route (Rust WASM).
     Camera + ZXing decode managed by qr-camera.js + kipukas-worker.js.
     Alpine state (showScanner, showFlash, videoReady, noCamera, showQRModal)
     removed from default.html â€” now server-driven HTML fragments. -->

<!-- Container for HTMX-swapped scanner UI (privacy modal, camera, results) -->
<div id="qr-container"></div>

<!-- Button to toggle QR scanner -->
<button aria-label="Toggle QR Scanner"
        class="flex justify-center"
        onclick="window.kipukasLoadQR().then(function() { if (window.kipukasQR) window.kipukasQR.toggle(); })">
  <svg xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 128 128" alt="QR Scanner Toggle"
    
      :class="'lg:fill-kip-goldenrod'"
    
    class="
    fill-kip-goldenrod
  h-12 w-12 z-auto hover:fill-kip-red active:fill-kip-drk-sienna">
    <path
      d="M306.692 182.753a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-16a2 2 0 0 0-2-2zm4 4h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2zM276.692 152.753a2.003 2.003 0 0 0-2 2v24a2.003 2.003 0 0 0 2 2h24a2.003 2.003 0 0 0 2-2v-24a2.003 2.003 0 0 0-2-2zm4 4h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-16a2 2 0 0 1-2-2v-16a2 2 0 0 1 2-2zm4 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2zM306.692 152.753a2.003 2.003 0 0 0-2 2v24a2.003 2.003 0 0 0 2 2h24a2.003 2.003 0 0 0 2-2v-24a2.003 2.003 0 0 0-2-2zm4 4h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-16a2 2 0 0 1-2-2v-16a2 2 0 0 1 2-2zm4 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2zM276.692 182.753a2.003 2.003 0 0 0-2 2v24a2.003 2.003 0 0 0 2 2h24a2.003 2.003 0 0 0 2-2v-24a2.003 2.003 0 0 0-2-2zm4 4h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-16a2 2 0 0 1-2-2v-16a2 2 0 0 1 2-2zm4 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2z"
      transform="matrix(2.2069 0 0 2.2069 -606.216 -337.109)"/>
  </svg>
</button>

    

    
      <button class="flex justify-center pt-2" aria-label="Search cards" x-ref="search" @click="showSearchBar = !showSearchBar; filter.all = !filter.all; if (!showSearchBar) { searchQuery = ''; }; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })">
        <svg class="h-10 w-10 stroke-2 stroke-kip-goldenrod hover:stroke-kip-red fill-amber-50" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z"/>
        </svg>
      </button>
      <input type="text" x-anchor.right-end.offset.10="$refs.search" x-trap="showSearchBar" x-transition x-show="showSearchBar" x-model="searchQuery" @input.debounce.300ms="if (window.kipukasRefreshCards) window.kipukasRefreshCards()" inputMode="text" aria-label="search the binder" id="search-input" size="3" class="w-36 h-9 bg-white border-2 px-2 py-2 rounded-md whitespace-nowrap border-kip-drk-sienna text-kip-drk-sienna focus:border-kip-red focus:ring-kip-red">
    

    

    
      <!-- local_fists_tool.html â€” Context-aware fists tool
     Shows local type matchup when not connected to a room,
     shows multiplayer fists combat when connected.
-->
<div x-data="{ showFistsMenu: false, showKeal: true, showMot: true, atkClick:[], defClick:[], atkMot:'', defMot:'' }" 
     class="relative place-content-center"
     @room-state-changed.window="if (showFistsMenu) $nextTick(() => { htmx.ajax('GET', '/api/fists/tool', {target:'#fists-tool-content', swap:'innerHTML'}) })">
  
  <!-- Fists toggle button -->
  <button aria-label="Toggle Fists Tool" x-ref="fistsButton" @click="showFistsMenu = !showFistsMenu">
    <svg :class="'lg:fill-kip-goldenrod'"
         class="
    fill-kip-goldenrod
   h-12 w-12 z-auto hover:fill-kip-red active:fill-kip-drk-sienna fill-current"
         viewBox="66.941444 -166.9827 33.866614 26.27061"
         xmlns="http://www.w3.org/2000/svg">
      <!-- Fist icon paths -->
      <path d="m 83.715193,-166.88575 c -0.17963,0.0931 -0.174138,-0.001 -0.174138,2.99205 0,1.74609 0.01432,2.86239 0.03722,2.90294 0.02046,0.0362 0.09013,0.0867 0.154791,0.11204 0.137599,0.054 0.326863,-4.7e-4 0.389931,-0.11204 0.04105,-0.0727 0.05383,-5.67031 0.01318,-5.77069 -0.02567,-0.0634 -0.209924,-0.16737 -0.293294,-0.16552 -0.02766,6.9e-4 -0.08512,0.0192 -0.127689,0.0412 z"/>
      <path d="m 86.340653,-164.21699 c -0.06912,0.0356 -0.122794,0.11069 -0.162685,0.22769 -0.43855,1.28633 -1.185321,3.58859 -1.185321,3.6543 0,0.047 0.03609,0.12887 0.0802,0.18201 0.09994,0.12038 0.343193,0.13543 0.456322,0.0282 0.03968,-0.0376 0.136831,-0.26447 0.215883,-0.50416 0.07905,-0.23969 0.35802,-1.08141 0.619931,-1.8705 0.30981,-0.93339 0.469369,-1.46857 0.456647,-1.53164 -0.02314,-0.11471 -0.180494,-0.24256 -0.29598,-0.24049 -0.04502,7e-4 -0.12827,0.0254 -0.184999,0.0546 z"/>
      <path d="m 91.764266,-161.72031 c -0.232351,0.032 -2.978379,0.98556 -3.212517,1.11557 -0.221212,0.12284 -0.495596,0.41872 -0.620751,0.66939 -0.07485,0.14992 -0.118675,0.33041 -0.162592,0.66964 l -0.06012,0.46441 -0.874318,-0.003 -0.874319,-0.003 -0.260847,0.11708 c -0.824637,0.37013 -1.166115,1.30224 -0.764265,2.08618 0.108165,0.211 0.383669,0.49785 0.61879,0.64426 l 0.09674,0.0602 c -0.276019,0.11138 -0.619674,0.16904 -0.784906,0.37121 -0.15093,0.18467 -0.273736,0.43651 -0.301663,0.71665 -0.02336,0.23431 0.132984,0.56114 0.2323,0.76224 0.111857,0.22649 0.915102,0.55304 1.085739,0.6401 0.07409,0.0378 0.07218,0.0117 -0.06096,0.14555 -0.316918,0.31841 -0.437491,0.64599 -0.415238,1.12811 0.01348,0.29204 0.03331,0.37308 0.142872,0.58395 0.145263,0.27959 0.412349,0.55097 0.669421,0.68019 l 0.297093,0.0621 -0.162917,0.2835 c -0.295252,0.51379 -0.299301,0.84195 -0.04335,1.37635 0.114944,0.23999 0.300732,0.51076 0.540868,0.6346 0.416653,0.21487 0.326749,0.40191 3.028616,0.38284 2.57887,-0.0182 2.97971,-0.0389 3.995377,-0.20631 0.831012,-0.13697 1.295057,-0.27219 2.186407,-0.63711 0.15761,-0.0645 0.302615,-0.0953 0.451463,-0.0959 1.102972,-0.26994 0.610793,-0.9896 -0.63554,-0.49422 -0.132876,0.0528 -0.389612,0.15447 -0.570523,0.2259 -0.692567,0.27344 -1.84457,0.48316 -3.076449,0.56007 -0.584689,0.0365 -1.335063,0.0495 -1.335063,0.0232 0,-0.008 0.0566,-0.12744 0.125769,-0.26583 0.117167,-0.23441 0.125767,-0.27806 0.125767,-0.63856 0,-0.37198 -0.0055,-0.39749 -0.142498,-0.65999 -0.07837,-0.15018 -0.195406,-0.32105 -0.260081,-0.37972 l -0.117584,-0.10667 0.249063,-0.21625 c 0.543617,-0.47197 0.68972,-1.17236 0.375487,-1.79995 -0.06255,-0.12491 -0.173185,-0.2912 -0.245874,-0.36953 l -0.132157,-0.14243 0.225225,-0.2134 c 0.615906,-0.58358 0.647142,-1.45209 0.0762,-2.11857 -0.123197,-0.14381 -0.1304,-0.16379 -0.07049,-0.19555 0.140188,-0.0743 0.331014,-0.25832 0.449726,-0.43361 0.06791,-0.10028 0.130172,-0.18232 0.138357,-0.18232 0.0082,0 0.08707,0.13612 0.175302,0.3025 0.420928,0.79372 1.285168,1.75081 1.580965,1.75081 0.169475,0 0.325924,-0.14512 0.325924,-0.30233 0,-0.11265 -0.04049,-0.1664 -0.328115,-0.43558 -0.36258,-0.33933 -0.617065,-0.64694 -0.856263,-1.03501 -0.3321,-0.53879 -0.611967,-1.22465 -0.765242,-1.87538 -0.09264,-0.3933 -0.187951,-0.53166 -0.366233,-0.53166 -0.144013,0 -1.038877,0.33089 -1.127381,0.41687 -0.0463,0.045 -0.125247,0.23291 -0.186062,0.44291 -0.337453,1.1653 -0.90372,2.13943 -1.35709,2.33456 -0.173593,0.0747 -0.412328,0.089 -0.525791,0.0315 -0.103703,-0.0526 -0.152422,-0.15302 -0.194599,-0.40117 -0.05335,-0.31386 0.348308,-3.70391 0.464381,-3.91949 0.169173,-0.3142 0.295915,-0.37794 1.802192,-0.90627 0.766209,-0.26876 1.465434,-0.49932 1.553833,-0.51238 0.249033,-0.0368 0.569216,0.0673 0.774454,0.25174 0.09392,0.0844 1.019039,1.0362 2.055816,2.11511 l 1.885051,1.96165 0.176946,0.0109 c 0.199981,0.0123 3.719098,-0.24006 3.810498,-0.27329 0.0701,-0.0255 0.17238,-0.20108 0.17238,-0.29597 0,-0.0923 -0.10678,-0.22843 -0.20771,-0.26479 -0.0493,-0.0178 -0.768859,0.0205 -1.747161,0.0929 -0.914845,0.0677 -1.717626,0.12356 -1.783961,0.12417 -0.134293,0.001 0.04915,0.18277 -2.595787,-2.56907 -0.868537,-0.90364 -1.427719,-1.45589 -1.547004,-1.52781 -0.323539,-0.19509 -0.737575,-0.27952 -1.11555,-0.22749 z"/>
      <path d="m 87.194131,-158.20094 c 0.19366,2.3e-4 0.371249,0.0127 0.394636,0.0275 0.03441,0.0218 -0.05934,1.00145 -0.175925,1.83823 -0.0012,0.008 -0.276993,0.006 -0.613049,-0.005 -0.811159,-0.0267 -1.039525,-0.11674 -1.257312,-0.49589 -0.224708,-0.39119 -0.164592,-0.79889 0.163658,-1.10992 0.2411,-0.22844 0.457537,-0.29805 0.849484,-0.2732 0.157517,0.01 0.444845,0.0184 0.638508,0.0187 z"/>
      <path d="m 91.058038,-157.5441 c 0.20234,0.37851 0.105197,0.83093 -0.238215,1.10946 -0.148503,0.12044 -0.48163,0.24911 -0.528925,0.20429 -0.01099,-0.0104 0.03959,-0.15706 0.112409,-0.32589 0.135509,-0.31414 0.297654,-0.76986 0.374211,-1.05173 0.05763,-0.21218 0.143389,-0.19265 0.28052,0.0639 z"/>
      <path d="m 87.420476,-155.64717 c 0.01597,0.009 0.02919,0.0528 0.0294,0.097 6.99e-4,0.13388 0.174679,0.44484 0.327901,0.58584 0.495904,0.45633 1.474324,0.23298 1.974369,-0.45071 0.09568,-0.13082 0.124123,-0.14643 0.266323,-0.1461 0.206559,4.6e-4 0.520993,0.14057 0.655578,0.29212 0.166822,0.18785 0.228226,0.32836 0.2486,0.56885 0.02426,0.28628 -0.08605,0.54435 -0.320014,0.74869 -0.231625,0.2023 -0.464481,0.26148 -0.939009,0.23866 -0.206799,-0.01 -0.997703,-0.0418 -1.757564,-0.0707 -1.260645,-0.048 -1.396873,-0.0594 -1.556439,-0.1305 -0.198282,-0.0883 -0.816103,-0.26903 -0.896605,-0.45159 -0.03342,-0.0758 -0.178664,-0.23019 -0.172544,-0.3916 0.0056,-0.14772 0.159915,-0.30303 0.187674,-0.37316 -0.11205,-0.28306 0.757541,-0.47031 1.065464,-0.54447 0.118196,-0.0285 0.827561,-0.006 0.886868,0.0277 z"/>
      <path d="m 90.089299,-153.04413 c 0.136427,0.0384 0.250377,0.10759 0.381078,0.23143 0.50995,0.48319 0.336931,1.259 -0.341093,1.52943 -0.127478,0.0508 -0.326069,0.0549 -1.634954,0.0334 -0.819418,-0.0135 -1.581637,-0.0416 -1.69382,-0.0625 -0.26825,-0.0501 -0.501411,-0.22101 -0.644665,-0.47266 -0.266144,-0.46753 -0.0551,-1.05761 0.461659,-1.29079 0.147111,-0.0664 0.232235,-0.0687 1.715985,-0.0465 1.214906,0.0182 1.604357,0.0355 1.75581,0.0781 z"/>
      <path d="m 89.926137,-150.51661 c 0.19648,0.0865 0.44491,0.32862 0.526176,0.51291 0.0778,0.17643 0.0679,0.55252 -0.01923,0.73045 -0.0956,0.19524 -0.293604,0.37942 -0.506938,0.47158 -0.165239,0.0714 -0.234453,0.0747 -1.354412,0.0653 -0.720791,-0.006 -1.237657,-0.0258 -1.327678,-0.0507 -0.188295,-0.0521 -0.470103,-0.28665 -0.578638,-0.48154 -0.110922,-0.19916 -0.117838,-0.60457 -0.01353,-0.79302 0.136024,-0.24576 0.371126,-0.43497 0.64258,-0.51715 0.05334,-0.0161 0.628115,-0.026 1.277264,-0.0219 1.106651,0.007 1.191136,0.0122 1.354412,0.0841 z"/>
      <path d="m 82.285738,-148.22719 c -0.06084,0.0242 -0.129272,0.0836 -0.152065,0.13182 -0.02279,0.0483 -0.315835,0.91522 -0.651207,1.92657 -0.568846,1.71543 -0.606254,1.84575 -0.557432,1.94199 0.10593,0.2088 0.375735,0.25343 0.526119,0.087 0.06929,-0.0767 1.286577,-3.70483 1.286812,-3.83537 1.93e-4,-0.10731 -0.133745,-0.25844 -0.247257,-0.279 -0.05189,-0.009 -0.144127,0.003 -0.20497,0.027 z"/>
      <path d="m 83.708049,-146.72468 c -0.0465,0.0178 -0.10309,0.0651 -0.125767,0.10526 -0.05405,0.0957 -0.05792,5.6997 -0.004,5.79515 0.02046,0.0362 0.09013,0.0867 0.154791,0.11203 0.1376,0.054 0.326863,-3.7e-4 0.389932,-0.11203 0.04105,-0.0727 0.05383,-5.67032 0.01318,-5.77069 -0.02597,-0.0641 -0.21154,-0.1681 -0.293294,-0.16432 -0.02766,10e-4 -0.08834,0.0168 -0.134834,0.0346 z"/>
      <path d="m 76.066528,-161.76814 c 0.23235,0.032 2.97838,0.98556 3.21252,1.11557 0.22121,0.12284 0.49559,0.41872 0.62075,0.66939 0.0749,0.14992 0.11867,0.33041 0.16259,0.66964 l 0.0601,0.46441 0.87432,-0.003 0.87432,-0.003 0.26084,0.11708 c 0.82464,0.37013 1.16612,1.30224 0.76427,2.08618 -0.10817,0.211 -0.38367,0.49785 -0.61879,0.64426 l -0.0967,0.0602 c 0.27602,0.11138 0.61967,0.16904 0.78491,0.37121 0.15093,0.18467 0.27373,0.43651 0.30166,0.71665 0.0234,0.23431 -0.13299,0.56114 -0.2323,0.76224 -0.11186,0.22649 -0.9151,0.55304 -1.08574,0.6401 -0.0741,0.0378 -0.0722,0.0117 0.061,0.14555 0.31692,0.31841 0.43749,0.64599 0.41524,1.12811 -0.0135,0.29204 -0.0333,0.37308 -0.14287,0.58395 -0.14527,0.27959 -0.41235,0.55097 -0.66943,0.68019 l -0.29709,0.0621 0.16292,0.2835 c 0.29525,0.51379 0.2993,0.84195 0.0434,1.37635 -0.11495,0.23999 -0.30073,0.51076 -0.54087,0.6346 -0.41665,0.21487 -0.32675,0.40191 -3.02862,0.38284 -2.57887,-0.0182 -2.97971,-0.0389 -3.99538,-0.20631 -0.83101,-0.13697 -1.29505,-0.27219 -2.1864,-0.63711 -0.15761,-0.0645 -0.30262,-0.0953 -0.45147,-0.0959 -1.10297,-0.26994 -0.61079,-0.9896 0.63554,-0.49422 0.13288,0.0528 0.38962,0.15447 0.57053,0.2259 0.69256,0.27344 1.84457,0.48316 3.07645,0.56007 0.58469,0.0365 1.33506,0.0495 1.33506,0.0232 0,-0.008 -0.0566,-0.12744 -0.12577,-0.26583 -0.11717,-0.23441 -0.12577,-0.27806 -0.12577,-0.63856 0,-0.37198 0.005,-0.39749 0.1425,-0.65999 0.0784,-0.15018 0.19541,-0.32105 0.26008,-0.37972 l 0.11759,-0.10667 -0.24907,-0.21625 c -0.54361,-0.47197 -0.68972,-1.17236 -0.37548,-1.79995 0.0626,-0.12491 0.17318,-0.2912 0.24587,-0.36953 l 0.13216,-0.14243 -0.22523,-0.2134 c -0.6159,-0.58358 -0.64714,-1.45209 -0.0762,-2.11857 0.1232,-0.14381 0.1304,-0.16379 0.0705,-0.19555 -0.14019,-0.0743 -0.33101,-0.25832 -0.44972,-0.43361 -0.0679,-0.10028 -0.13018,-0.18232 -0.13836,-0.18232 -0.008,0 -0.0871,0.13612 -0.1753,0.3025 -0.42093,0.79372 -1.28517,1.75081 -1.58097,1.75081 -0.16947,0 -0.32592,-0.14512 -0.32592,-0.30233 0,-0.11265 0.0405,-0.1664 0.32811,-0.43558 0.36258,-0.33933 0.61707,-0.64694 0.85627,-1.03501 0.3321,-0.53879 0.61196,-1.22465 0.76524,-1.87538 0.0926,-0.3933 0.18795,-0.53166 0.36623,-0.53166 0.14401,0 1.03888,0.33089 1.12738,0.41687 0.0463,0.045 0.12525,0.23291 0.18606,0.44291 0.33746,1.1653 0.90372,2.13943 1.35709,2.33456 0.1736,0.0747 0.41233,0.089 0.5258,0.0315 0.1037,-0.0526 0.15242,-0.15302 0.19459,-0.40117 0.0533,-0.31386 -0.3483,-3.70391 -0.46438,-3.91949 -0.16917,-0.3142 -0.29591,-0.37794 -1.80219,-0.90627 -0.76621,-0.26876 -1.46543,-0.49932 -1.55383,-0.51238 -0.24903,-0.0368 -0.56922,0.0673 -0.77446,0.25174 -0.0939,0.0844 -1.01903,1.0362 -2.05581,2.11511 l -1.88505,1.96165 -0.17695,0.0109 c -0.19998,0.0123 -3.719097,-0.24006 -3.810497,-0.27329 -0.0701,-0.0255 -0.17238,-0.20108 -0.17238,-0.29597 0,-0.0923 0.10678,-0.22843 0.20771,-0.26479 0.0493,-0.0178 0.76886,0.0205 1.74716,0.0929 0.91485,0.0677 1.717627,0.12356 1.783967,0.12417 0.13429,0.001 -0.0491,0.18277 2.59578,-2.56907 0.86854,-0.90364 1.42772,-1.45589 1.54701,-1.52781 0.32354,-0.19509 0.73757,-0.27952 1.11555,-0.22749 z"/>
      <path d="m 80.636668,-158.24877 c -0.19366,2.3e-4 -0.37125,0.0127 -0.39464,0.0275 -0.0344,0.0218 0.0593,1.00145 0.17592,1.83823 0.001,0.008 0.277,0.006 0.61305,-0.005 0.81116,-0.0267 1.03953,-0.11674 1.25732,-0.49589 0.2247,-0.39119 0.16459,-0.79889 -0.16366,-1.10992 -0.2411,-0.22844 -0.45754,-0.29805 -0.84949,-0.2732 -0.15751,0.01 -0.44484,0.0184 -0.6385,0.0187 z"/>
      <path d="m 76.772758,-157.59193 c -0.20234,0.37851 -0.1052,0.83093 0.23821,1.10946 0.1485,0.12044 0.48163,0.24911 0.52893,0.20429 0.011,-0.0104 -0.0396,-0.15706 -0.11241,-0.32589 -0.13551,-0.31414 -0.29766,-0.76986 -0.37421,-1.05173 -0.0576,-0.21218 -0.14339,-0.19265 -0.28052,0.0639 z"/>
      <path d="m 80.410318,-155.695 c -0.016,0.009 -0.0292,0.0528 -0.0294,0.097 -7e-4,0.13388 -0.17468,0.44484 -0.3279,0.58584 -0.49591,0.45633 -1.47433,0.23298 -1.97437,-0.45071 -0.0957,-0.13082 -0.12412,-0.14643 -0.26632,-0.1461 -0.20656,4.6e-4 -0.521,0.14057 -0.65558,0.29212 -0.16682,0.18785 -0.22823,0.32836 -0.2486,0.56885 -0.0243,0.28628 0.0861,0.54435 0.32001,0.74869 0.23163,0.2023 0.46448,0.26148 0.93901,0.23866 0.2068,-0.01 0.9977,-0.0418 1.75756,-0.0707 1.26065,-0.048 1.39688,-0.0594 1.55645,-0.1305 0.19828,-0.0883 0.8161,-0.26903 0.8966,-0.45159 0.0334,-0.0758 0.17866,-0.23019 0.17254,-0.3916 -0.006,-0.14772 -0.15991,-0.30303 -0.18767,-0.37316 -0.11205,-0.28306 -0.75754,-0.47031 -1.06546,-0.54447 -0.1182,-0.0285 -0.82756,-0.006 -0.88687,0.0277 z"/>
      <path d="m 77.741498,-153.09196 c -0.13643,0.0384 -0.25038,0.10759 -0.38108,0.23143 -0.50995,0.48319 -0.33693,1.259 0.34109,1.52943 0.12748,0.0508 0.32607,0.0549 1.63495,0.0334 0.81942,-0.0135 1.58164,-0.0416 1.69383,-0.0625 0.26825,-0.0501 0.50141,-0.22101 0.64466,-0.47266 0.26615,-0.46753 0.0551,-1.05761 -0.46166,-1.29079 -0.14711,-0.0664 -0.23223,-0.0687 -1.71598,-0.0465 -1.21491,0.0182 -1.60436,0.0355 -1.75581,0.0781 z"/>
      <path d="m 77.904658,-150.56444 c -0.19648,0.0865 -0.44491,0.32862 -0.52618,0.51291 -0.0778,0.17643 -0.0679,0.55252 0.0192,0.73045 0.0956,0.19524 0.2936,0.37942 0.50694,0.47158 0.16524,0.0714 0.23445,0.0747 1.35441,0.0653 0.72079,-0.006 1.23766,-0.0258 1.32768,-0.0507 0.1883,-0.0521 0.4701,-0.28665 0.57864,-0.48154 0.11092,-0.19916 0.11784,-0.60457 0.0135,-0.79302 -0.13602,-0.24576 -0.37113,-0.43497 -0.64258,-0.51715 -0.0533,-0.0161 -0.62812,-0.026 -1.27727,-0.0219 -1.10665,0.007 -1.19113,0.0122 -1.35441,0.0841 z"/>
    </svg>
  </button>

  <!-- Fists tool dropdown menu -->
  <div x-show="showFistsMenu" x-cloak
       x-anchor.right-end.offset.10="$refs.fistsButton"
       x-transition.duration.350ms
       class="
    z-40 gap-2 text-kip-drk-goldenrod bg-amber-50 mt-2 py-3 pl-4 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transition-opacity duration-300
   h-fit w-72"
       x-effect="if (showFistsMenu) $nextTick(() => { htmx.ajax('GET', '/api/fists/tool', {target:'#fists-tool-content', swap:'innerHTML'}) })">
    
    <!-- Content container - populated by WASM based on connection state -->
    <div id="fists-tool-content"
         hx-get="/api/fists/tool"
         hx-trigger="load"
         hx-swap="innerHTML">
      <!-- WASM renders local type matchup or multiplayer fists based on room state -->
    </div>
  </div>
</div>
    

    
        <!-- Phase 3b: Turn tracker with HTMX + WASM state management.
     The popover toggle (showTurnTracker) stays Alpine â€” purely visual.
     Timer creation form is loaded from WASM. Alarm state lives in WASM memory. -->
<div x-data="{ showTurnTracker: false }">
    <svg xmlns="http://www.w3.org/2000/svg" 
    @click="showTurnTracker = !showTurnTracker"
    x-ref="turnTracker"
    viewBox="0 0 24 24"
    
        :class="'lg:stroke-kip-goldenrod'"
    
    class="
    stroke-kip-goldenrod
  h-12 w-12 z-auto fill-transparent stroke stroke-2 hover:stroke-kip-red active:stroke-kip-drk-sienna">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>

    <div x-show="showTurnTracker" x-cloak
    x-anchor.right-end.offset.10="$refs.turnTracker"
    x-transition.duration.350ms
    class="
    z-40 gap-2 text-kip-drk-goldenrod bg-amber-50 mt-2 py-3 pl-4 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transition-opacity duration-300
   grid grid-cols-1 h-fit w-40"
    hx-get="/api/game/turns"
    hx-trigger="intersect once"
    hx-swap="innerHTML">
    </div>
</div>

<!-- Floating alarm display â€” loaded from WASM, positioned top-left -->
<div id="turn-alarms" class="fixed top-0 left-0 m-6 grid grid-cols-1"
     hx-get="/api/game/turns?display=alarms"
     hx-trigger="load"
     hx-swap="innerHTML"
     hx-target="this">
</div>

    

    
      <!-- multiplayer.html â€” Room management modal (Phase 4, refactored)
     Room creation/join/disconnect only. Fists combat moved to local_fists_tool.html.
-->
<div x-data="{ showMultiplayer: false }" class="relative place-content-center"
     @close-multiplayer.window="showMultiplayer = false">
  <!-- Multiplayer toggle button (WiFi icon) -->
  <button aria-label="Toggle Multiplayer Room" @click="window.kipukasLoadMultiplayer().then(function() { showMultiplayer = !showMultiplayer })">
    <svg xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      
        :class="'lg:fill-kip-goldenrod'"
      
      class="
    fill-kip-goldenrod
   h-12 w-12 z-auto hover:fill-kip-red active:fill-kip-drk-sienna fill-current">
      <path fill-rule="evenodd" d="M1.371 8.143c5.858-5.857 15.356-5.857 21.213 0a.75.75 0 0 1 0 1.061.75.75 0 0 1-1.06 0c-5.273-5.272-13.821-5.272-19.092 0a.75.75 0 0 1-1.06-1.06Zm3.182 3.182c4.1-4.1 10.749-4.1 14.85 0a.75.75 0 1 1-1.061 1.06 8.25 8.25 0 0 0-12.728 0 .75.75 0 0 1-1.06-1.06Zm3.182 3.182a6 6 0 0 1 8.486 0 .75.75 0 1 1-1.06 1.06 4.5 4.5 0 0 0-6.364 0 .75.75 0 0 1-1.06-1.06ZM12 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 0 1.5H12.75A.75.75 0 0 1 12 18Z" clip-rule="evenodd" />
    </svg>
  </button>

  <!-- Full-screen modal overlay (room management only) -->
  <div x-show="showMultiplayer" x-cloak
    class="fixed inset-0 flex items-center justify-center z-50"
    x-transition.duration.350ms
    x-effect="if (showMultiplayer) $nextTick(() => { if (typeof htmx !== 'undefined') { htmx.ajax('GET', '/api/room/status', {target:'#room-status', swap:'innerHTML'}); } })">

    <!-- Backdrop -->
    <div class="absolute inset-0 bg-slate-300 opacity-75" @click="showMultiplayer = false"></div>

    <!-- Modal content (room status only) -->
    <div class="bg-amber-50 z-50 rounded-lg shadow-xl w-full max-w-sm max-h-[85vh] overflow-y-auto relative">
      <div id="room-status"
        hx-get="/api/room/status"
        hx-trigger="load"
        hx-swap="innerHTML">
      </div>

      <!-- Close button -->
      <div class="border-t border-slate-300 p-3">
        <button @click="showMultiplayer = false"
          class="w-full bg-slate-400 hover:bg-slate-500 text-amber-50 font-bold py-2 px-4 rounded text-sm">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
    

    
      <div x-data="{ showFilter: false, showVariation: false, showSoulType: false, showMotivation: false, showHabitat: false }" class="relative place-content-center">
    <div x-show="showFilter" 
        x-anchor.right-end.offset.10="$refs.filter"
        x-transition.duration.350ms 
        class="text-kip-drk-goldenrod bg-amber-50 mt-2 h-fit w-36 py-3 pl-4 rounded-md shadow-lg ring-1 ring-black/5 focus:outline-hidden transition-opacity duration-300">
        <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :checked="filter.all" @click="filter.all = !filter.all; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="All" checked><label for="All">Show All - <strong>56</strong></label></div>
        <div class="flex">
            <svg xmlns="http://www.w3.org/2000/svg" alt="Variation toggle"
                @click="showVariation = !showVariation" :class="{ 'rotate-90': showVariation }"
                class="fill-none stroke-2 stroke-kip-drk-goldenrod w-6 h-6 transition-transform">
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
            </svg>
            <div>Variations</div>
        </div>
        <div x-show="showVariation">
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Character = !filter.Character; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Character"><label for="Character">Character</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Species = !filter.Species; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Species"><label for="Species">Species</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.TerrainFeature = !filter.TerrainFeature; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="TerrainFeature"><label for="TerrainFeature">TerrainFeature</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Trap = !filter.Trap; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Trap"><label for="Trap">Trap</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Sabotage = !filter.Sabotage; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Sabotage"><label for="Sabotage">Sabotage</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.PersonalEffect = !filter.PersonalEffect; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="PersonalEffect"><label for="PersonalEffect">PersonalEffect</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Item = !filter.Item; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Item"><label for="Item">Item</label></div>
            
            <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.card = !filter.card; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Other"><label for="Other">Other</label></div>
        </div>
        <div class="flex">
            <svg xmlns="http://www.w3.org/2000/svg" alt="Soul type toggle"
                @click="showSoulType = !showSoulType" :class="{ 'rotate-90': showSoulType }"
                class="fill-none stroke-2 stroke-kip-drk-goldenrod w-6 h-6 transition-transform">
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
            </svg>
            <div>Soul Types</div>
        </div>
        <div x-show="showSoulType">
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Cenozoic = !filter.Cenozoic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Cenozoic"><label for="Cenozoic">Cenozoic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Decrepit = !filter.Decrepit; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Decrepit"><label for="Decrepit">Decrepit</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Angelic = !filter.Angelic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Angelic"><label for="Angelic">Angelic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Brutal = !filter.Brutal; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Brutal"><label for="Brutal">Brutal</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Arboreal = !filter.Arboreal; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Arboreal"><label for="Arboreal">Arboreal</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Astral = !filter.Astral; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Astral"><label for="Astral">Astral</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Telekinetic = !filter.Telekinetic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Telekinetic"><label for="Telekinetic">Telekinetic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Glitch = !filter.Glitch; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Glitch"><label for="Glitch">Glitch</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Magic = !filter.Magic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Magic"><label for="Magic">Magic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Endothermic = !filter.Endothermic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Endothermic"><label for="Endothermic">Endothermic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Avian = !filter.Avian; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Avian"><label for="Avian">Avian</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Mechanical = !filter.Mechanical; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Mechanical"><label for="Mechanical">Mechanical</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Algorithmic = !filter.Algorithmic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Algorithmic"><label for="Algorithmic">Algorithmic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Energetic = !filter.Energetic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Energetic"><label for="Energetic">Energetic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Entropic = !filter.Entropic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Entropic"><label for="Entropic">Entropic</label></div>
            
        </div>
        <div class="flex">
            <svg xmlns="http://www.w3.org/2000/svg" alt="Motivation toggle"
                @click="showMotivation = !showMotivation" :class="{ 'rotate-90': showMotivation }"
                class="fill-none stroke-2 stroke-kip-drk-goldenrod w-6 h-6 transition-transform">
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
            </svg>
            <div>Motivations</div>
        </div>
        <div x-show="showMotivation">
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Spirit = !filter.Spirit; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Spirit"><label for="Spirit">Spirit</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Service = !filter.Service; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Service"><label for="Service">Service</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Survival = !filter.Survival; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Survival"><label for="Survival">Survival</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Possessor = !filter.Possessor; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Possessor"><label for="Possessor">Possessor</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Satisfaction = !filter.Satisfaction; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Satisfaction"><label for="Satisfaction">Satisfaction</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Sacrifice = !filter.Sacrifice; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Sacrifice"><label for="Sacrifice">Sacrifice</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Conscience = !filter.Conscience; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Conscience"><label for="Conscience">Conscience</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Passion = !filter.Passion; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Passion"><label for="Passion">Passion</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Duty = !filter.Duty; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Duty"><label for="Duty">Duty</label></div>
            
        </div>
        <div class="flex">
            <svg xmlns="http://www.w3.org/2000/svg" alt="Habitat toggle"
                @click="showHabitat = !showHabitat" :class="{ 'rotate-90': showHabitat }"
                class="fill-none stroke-2 stroke-kip-drk-goldenrod w-6 h-6 transition-transform">
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
            </svg>
            <div>Habitats</div>
        </div>
        <div x-show="showHabitat">
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Mountain = !filter.Mountain; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Mountain"><label for="Mountain">Mountain</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Forest = !filter.Forest; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Forest"><label for="Forest">Forest</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Plains = !filter.Plains; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Plains"><label for="Plains">Plains</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Water = !filter.Water; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Water"><label for="Water">Water</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Heavens = !filter.Heavens; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Heavens"><label for="Heavens">Heavens</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Volcanic = !filter.Volcanic; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Volcanic"><label for="Volcanic">Volcanic</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Underground = !filter.Underground; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Underground"><label for="Underground">Underground</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.DigitalCloud = !filter.DigitalCloud; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="DigitalCloud"><label for="DigitalCloud">DigitalCloud</label></div>
            
                <div><input type="checkbox" class="text-kip-red rounded mr-2 focus:ring-1 focus:ring-kip-red disabled:bg-slate-100" :disabled="filter.all" @click="filter.Nomad = !filter.Nomad; $nextTick(() => { if (window.kipukasRefreshCards) window.kipukasRefreshCards() })" id="Nomad"><label for="Nomad">Nomad</label></div>
            
        </div>
    </div>
    <button aria-label="show filter options">
        <svg xmlns="http://www.w3.org/2000/svg" alt="Filter toggle" viewBox="0 0 24 24"
        @click="showFilter = !showFilter"
        x-ref="filter"
        class="h-14 w-14 stroke-1 stroke-kip-goldenrod fill-amber-50 hover:stroke-kip-red active:stroke-drk-sienna">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" />
        </svg>
    </button>
</div>
    

    

    

    
      <a :href="previousURL" aria-label="Go to last visited page" class="flex justify-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          
            :class="'lg:stroke-kip-goldenrod'"
          
          class="w-9 h-9 fill-transparent z-auto hover:stroke-kip-red active:stroke-kip-drk-sienna 
    stroke-kip-goldenrod
   stroke-2 m-2" 
    stroke-kip-goldenrod
  >
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
        </svg>
      </a>
    
    
    
  </div>
  
  <svg xmlns="http://www.w3.org/2000/svg" alt="tools toggle"
    @click="showTools = !showTools" :class="{ 'rotate-180': !showTools }" x-transition
    class="fill-none stroke-2 stroke-kip-drk-goldenrod w-6 h-6 mb-2 place-self-center">
    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
  </svg>
  
  
</div>

<!-- Card grid: HTMX infinite scroll powered by WASM /api/cards -->
<!-- Uses CSS Grid with dynamic batch sizing based on viewport -->
 <template x-if="true">
  <!-- Mobile: 160px min, Desktop (md+): 200px min for better desktop experience -->
  <div id="card-grid"
    class="grid gap-5 justify-items-center px-4 grid-cols-[repeat(auto-fill,minmax(160px,1fr))] md:grid-cols-[repeat(auto-fill,minmax(200px,1fr))]"
    hx-get="/api/cards?page=0&per=12&all=true"
    hx-trigger="load"
    hx-swap="innerHTML swap:150ms"></div>
  </div>
</template>
<!-- Idiomorph extension for smooth DOM morphing on filter/search (bundled locally) -->
<script src="/assets/js/idiomorph-ext.min.js" defer></script>

<script>
  // Dynamic batch sizing based on viewport
  // Calculates optimal number of cards to load based on visible grid columns
  window.kipukasBatchSize = (function() {
    var cardMinWidth = 160; // minmax(160px, 1fr)
    var gap = 20; // gap-5 = 1.25rem = 20px
    var padding = 32; // px-4 = 1rem = 16px each side = 32px total
    var desiredRows = 3; // Load 3 rows at a time for smooth scrolling

    function calculateBatchSize() {
      var viewportWidth = window.innerWidth;
      var availableWidth = viewportWidth - padding;
      var cardsPerRow = Math.floor((availableWidth + gap) / (cardMinWidth + gap));
      // Ensure at least 2 cards per row on very small screens
      cardsPerRow = Math.max(cardsPerRow, 2);
      return cardsPerRow * desiredRows;
    }

    return {
      get: calculateBatchSize,
      getColumns: function() {
        var viewportWidth = window.innerWidth;
        var availableWidth = viewportWidth - padding;
        return Math.max(Math.floor((availableWidth + gap) / (cardMinWidth + gap)), 2);
      }
    };
  })();

  // Update initial load with dynamic batch size
  document.addEventListener('DOMContentLoaded', function() {
    var cardGrid = document.getElementById('card-grid');
    if (cardGrid) {
      var optimalBatch = window.kipukasBatchSize.get();
      // Update the hx-get attribute with optimal batch size
      var currentUrl = cardGrid.getAttribute('hx-get');
      var newUrl = currentUrl.replace(/per=\d+/, 'per=' + optimalBatch);
      cardGrid.setAttribute('hx-get', newUrl);
    }
  });

  // Called by filter checkboxes and search input to refresh the card grid.
  // Reads Alpine reactive state, builds query string, calls htmx.ajax()
  // through the same WASM bridge path (Phase 2 lesson #4).
  window.kipukasRefreshCards = function() {
    if (typeof Alpine === 'undefined' || typeof htmx === 'undefined') return;

    var data = Alpine.$data(document.body);
    var filter = data.filter || {};
    var search = (data.searchQuery || '').trim();
    
    // Use dynamic batch size based on viewport
    var optimalBatch = window.kipukasBatchSize ? window.kipukasBatchSize.get() : 12;
    var params = ['page=0', 'per=' + optimalBatch];

    if (search) {
      // Search mode: search across all cards regardless of filters
      params.push('search=' + encodeURIComponent(search));
    } else if (filter.all) {
      // Show All mode
      params.push('all=true');
    } else {
      // Filter mode: collect active filter keys
      var active = [];
      var keys = Object.keys(filter);
      for (var i = 0; i < keys.length; i++) {
        if (keys[i] !== 'all' && filter[keys[i]] === true) {
          active.push(keys[i]);
        }
      }
      if (active.length > 0) {
        params.push('filter=' + encodeURIComponent(active.join(',')));
      }
      // If no active filters, params has no filter/all/search â†’ WASM returns empty grid
    }

    var url = '/api/cards?' + params.join('&');
    // Use morph swap for filter/search to preserve DOM state where possible
    htmx.ajax('GET', url, {target: '#card-grid', swap: 'morph:innerHTML'});
  };

  // Image preloading for smoother infinite scroll experience
  // Preloads images from the next batch when cards are rendered
  document.addEventListener('htmx:afterSwap', function(evt) {
    // Only process card grid updates
    if (!evt.detail.target || evt.detail.target.id !== 'card-grid') return;

    // Find all image srcset URLs in the newly added content and preload them
    var images = evt.detail.target.querySelectorAll('img[srcset]');
    images.forEach(function(img) {
      // Preload the image
      var preloadImg = new Image();
      preloadImg.src = img.src;
    });

    // Look for sentinel and preload next batch images (if any are embedded in response)
    var sentinel = evt.detail.target.querySelector('[data-scroll-load="true"]');
    if (sentinel && sentinel.dataset.nextImages) {
      try {
        var nextImages = JSON.parse(sentinel.dataset.nextImages);
        nextImages.forEach(function(src) {
          var img = new Image();
          img.src = src;
        });
      } catch (e) {
        // Silently fail if parsing fails
      }
    }
  });
</script></div>
  </body>
</html>
