---
layout: default
permalink: /
title: "Binder Home"
description: "This is the home of all the cards ever produced by Kipukas! Whether
you are planning you next dominating game strategy or browsing for lovely pieces of
art you came to the right place."
bg-terra: "bg-hero-pattern "
---

{% include toolbar.html 
  qr_scanner=true 
  type_matchup=true
  multiplayer_home=true
  lastPage=true
  hamburger=true
  filter=true
  turn_tracker=true
  install_pwa=true
  logo=true
  hideTools=true
  search=true
  base_fill='fill-kip-goldenrod'
  base_stroke='stroke-kip-goldenrod'
  background_color='bg-slate-100/80'
%}

<!-- Card grid: HTMX infinite scroll powered by WASM /api/cards -->
<div id="card-grid"
  class="flex flex-wrap gap-x-5 content-auto place-content-center"
  hx-get="/api/cards?page=0&per=12&all=true"
  hx-trigger="load"
  hx-swap="innerHTML swap:150ms">
</div>

<!-- Idiomorph extension for smooth DOM morphing on filter/search -->
<script src="https://unpkg.com/idiomorph@0.7.4/dist/idiomorph-ext.min.js" defer></script>

<script>
  // Called by filter checkboxes and search input to refresh the card grid.
  // Reads Alpine reactive state, builds query string, calls htmx.ajax()
  // through the same WASM bridge path (Phase 2 lesson #4).
  window.kipukasRefreshCards = function() {
    if (typeof Alpine === 'undefined' || typeof htmx === 'undefined') return;

    var data = Alpine.$data(document.body);
    var filter = data.filter || {};
    var search = (data.searchQuery || '').trim();

    var params = ['page=0', 'per=12'];

    if (search) {
      // Search mode: search across all cards regardless of filters
      params.push('search=' + encodeURIComponent(search));
    } else if (filter.all) {
      // Show All mode
      params.push('all=true');
    } else {
      // Filter mode: collect active filter keys
      var active = [];
      var keys = Object.keys(filter);
      for (var i = 0; i < keys.length; i++) {
        if (keys[i] !== 'all' && filter[keys[i]] === true) {
          active.push(keys[i]);
        }
      }
      if (active.length > 0) {
        params.push('filter=' + encodeURIComponent(active.join(',')));
      }
      // If no active filters, params has no filter/all/search â†’ WASM returns empty grid
    }

    var url = '/api/cards?' + params.join('&');
    // Use morph swap for filter/search to preserve DOM state where possible
    htmx.ajax('GET', url, {target: '#card-grid', swap: 'morph:innerHTML'});
  };

  // Image preloading for smoother infinite scroll experience
  // Preloads images from the next batch when cards are rendered
  document.addEventListener('htmx:afterSwap', function(evt) {
    // Only process card grid updates
    if (!evt.detail.target || evt.detail.target.id !== 'card-grid') return;

    // Find all image srcset URLs in the newly added content and preload them
    var images = evt.detail.target.querySelectorAll('img[srcset]');
    images.forEach(function(img) {
      // Preload the image
      var preloadImg = new Image();
      preloadImg.src = img.src;
    });

    // Look for sentinel and preload next batch images (if any are embedded in response)
    var sentinel = evt.detail.target.querySelector('[data-scroll-load="true"]');
    if (sentinel && sentinel.dataset.nextImages) {
      try {
        var nextImages = JSON.parse(sentinel.dataset.nextImages);
        nextImages.forEach(function(src) {
          var img = new Image();
          img.src = src;
        });
      } catch (e) {
        // Silently fail if parsing fails
      }
    }
  });
</script>
